{"version":3,"sources":["../../src/forms/formGroupAsync.js"],"names":["flattenObj","obj","Object","keys","map","key","reduce","prev","current","assign","FormGroupAsync","formName","groups","resolve","bind","reject","generatePromises","successCallbacks","failCallbacks","resolvedMemo","resolvers","rejecters","handlePromises","getNames","groupName","Promise","promises","all","then","forEach","fn","console","warn","catch","err","groupData","errorMsgs","Error","getName","group","cb","isSingleCallback","push"],"mappings":"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","file":"formGroupAsync.js","sourcesContent":["import { includes } from './formUtils';\n\nfunction flattenObj(obj) {\n  return Object.keys(obj)\n    .map(key => obj[key])\n    .reduce((prev, current) => Object.assign({}, prev, current), {});\n}\n\nexport default class FormGroupAsync {\n  constructor({ formName, groups }) {\n    this.formName = formName;\n    this.groups = [...groups];\n\n    this.resolve = this.resolve.bind(this);\n    this.reject = this.reject.bind(this);\n    this.generatePromises = this.generatePromises.bind(this);\n\n    this.successCallbacks = [];\n    this.failCallbacks = [];\n\n    this.resolvedMemo = {};\n    this.generatePromises();\n  }\n\n  generatePromises() {\n    this.successCallbacks = [];\n    this.failCallbacks = [];\n\n    this.resolvers = {};\n    this.rejecters = {};\n    this.handlePromises(this.getNames().map((groupName) => {\n      if (this.resolvedMemo[groupName]) {\n        return Promise.resolve(this.resolvedMemo[groupName]);\n      }\n\n      return new Promise((resolve, reject) => {\n        this.resolvers[groupName] = resolve;\n        this.rejecters[groupName] = reject;\n      });\n    }));\n  }\n\n  handlePromises(promises) {\n    Promise\n      .all(promises)\n      .then(() => {\n        /* istanbul ignore next */\n        if (this.successCallbacks[0]) {\n          this.successCallbacks.forEach(fn => fn(flattenObj(this.resolvedMemo)));\n        } else {\n          console.warn('No success callback specified');\n        }\n\n        this.resolvedMemo = {};\n      })\n      .catch((err) => {\n        /* istanbul ignore next */\n        if (this.failCallbacks[0]) {\n          this.failCallbacks.forEach(fn => fn(err));\n        } else {\n          console.warn('No fail callback specified');\n        }\n      })\n      .then(this.generatePromises);\n  }\n\n  resolve(groupData, groupName) {\n    if (this.resolvers[groupName]) {\n      this.resolvers[groupName](groupData);\n    }\n\n    this.resolvedMemo[groupName] = groupData;\n    return this;\n  }\n\n  reject(errorMsgs, groupName) {\n    if (this.rejecters[groupName]) {\n      this.rejecters[groupName](errorMsgs);\n    }\n\n    this.resolvedMemo[groupName] = null;\n    return this;\n  }\n\n  getName(key) {\n    if (!(includes(this.groups, key))) {\n      throw new Error(`${key} group is not found in ${this.formName} groups. Did you mispell it?`);\n    }\n\n    return `${this.formName}-${key}`;\n  }\n\n  getNames() {\n    return this.groups.map(group => this.getName(group));\n  }\n\n  each(cb) {\n    this.getNames().forEach(cb);\n    return this;\n  }\n\n  // use single callback if you want to override the previous success callback instead of executing all\n  then(fn, isSingleCallback = false) {\n    if (isSingleCallback) {\n      this.successCallbacks = [fn.bind(this)];\n    } else {\n      this.successCallbacks.push(fn.bind(this));\n    }\n\n    return this;\n  }\n\n  fail(fn, isSingleCallback = false) {\n    if (isSingleCallback) {\n      this.failCallbacks = [fn.bind(this)];\n    } else {\n      this.failCallbacks.push(fn.bind(this));\n    }\n\n    return this;\n  }\n}\n"]}