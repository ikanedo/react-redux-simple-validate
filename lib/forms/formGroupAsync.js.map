{"version":3,"sources":["../../src/forms/formGroupAsync.js"],"names":["flattenObj","obj","Object","keys","map","key","reduce","prev","current","assign","FormGroupAsync","formName","groups","resolve","bind","reject","generatePromises","setGroups","successCallbacks","failCallbacks","resolvedMemo","Array","isArray","Error","groupKeyToAdd","groupKeyToRemove","isForceRemove","hasGroupKey","filter","group","resolvers","rejecters","handlePromises","getNames","groupName","Promise","promises","all","then","forEach","fn","catch","err","groupData","errorMsgs","getName","cb","isSingleCallback","push"],"mappings":"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","file":"formGroupAsync.js","sourcesContent":["import { includes } from './formUtils';\n\nfunction flattenObj(obj) {\n  return Object.keys(obj)\n    .map(key => obj[key])\n    .reduce((prev, current) => Object.assign({}, prev, current), {});\n}\n\nexport default class FormGroupAsync {\n  constructor({ formName, groups }) {\n    this.formName = formName;\n    this.groups = [...groups];\n\n    this.resolve = this.resolve.bind(this);\n    this.reject = this.reject.bind(this);\n    this.generatePromises = this.generatePromises.bind(this);\n    this.setGroups = this.setGroups.bind(this);\n\n    this.successCallbacks = [];\n    this.failCallbacks = [];\n\n    this.resolvedMemo = {};\n    this.generatePromises();\n  }\n\n  setGroups(groups) {\n    if (!Array.isArray(groups)) {\n      throw new Error(`${groups} - Group name is expected to be a string`);\n    }\n\n    this.groups = groups;\n    this.generatePromises();\n  }\n\n  addGroup(groupKeyToAdd) {\n    if (typeof groupKeyToAdd !== 'string') {\n      throw new Error(`${groupKeyToAdd} - Group name is expected to be a string`);\n    }\n\n    this.groups = [\n      ...this.groups,\n      groupKeyToAdd\n    ];\n    this.generatePromises();\n  }\n\n  removeGroup(groupKeyToRemove, isForceRemove) {\n    if (typeof groupKeyToRemove !== 'string') {\n      throw new Error(`${groupKeyToRemove} - Group name is expected to be a string`);\n    }\n\n    const hasGroupKey = this.groups.filter(group => group === groupKeyToRemove)[0];\n    if (!hasGroupKey && !isForceRemove) {\n      throw new Error(`${groupKeyToRemove} - Group to remove is not found. Did you mispell it?`);\n    }\n\n    this.groups = this.groups.filter(group => group !== groupKeyToRemove);\n    this.generatePromises();\n  }\n\n  generatePromises() {\n    this.successCallbacks = [];\n    this.failCallbacks = [];\n\n    this.resolvers = {};\n    this.rejecters = {};\n    this.handlePromises(this.getNames().map((groupName) => {\n      if (this.resolvedMemo[groupName]) {\n        return Promise.resolve(this.resolvedMemo[groupName]);\n      }\n\n      return new Promise((resolve, reject) => {\n        this.resolvers[groupName] = resolve;\n        this.rejecters[groupName] = reject;\n      });\n    }));\n  }\n\n  handlePromises(promises) {\n    Promise\n      .all(promises)\n      .then(() => {\n        /* istanbul ignore next */\n        if (this.successCallbacks[0]) {\n          this.successCallbacks.forEach(fn => fn(flattenObj(this.resolvedMemo)));\n        }\n\n        this.resolvedMemo = {};\n      })\n      .catch((err) => {\n        /* istanbul ignore next */\n        if (this.failCallbacks[0]) {\n          this.failCallbacks.forEach(fn => fn(err));\n        }\n      })\n      .then(this.generatePromises);\n  }\n\n  resolve(groupData, groupName) {\n    if (this.resolvers[groupName]) {\n      this.resolvers[groupName](groupData);\n    }\n\n    this.resolvedMemo[groupName] = groupData;\n    return this;\n  }\n\n  reject(errorMsgs, groupName) {\n    if (this.rejecters[groupName]) {\n      this.rejecters[groupName](errorMsgs);\n    }\n\n    this.resolvedMemo[groupName] = null;\n    return this;\n  }\n\n  getName(key) {\n    if (!(includes(this.groups, key))) {\n      throw new Error(`${key} group is not found in ${this.formName} groups. Did you mispell it?`);\n    }\n\n    return `${this.formName}-${key}`;\n  }\n\n  getNames() {\n    return this.groups.map(group => this.getName(group));\n  }\n\n  each(cb) {\n    this.getNames().forEach(cb);\n    return this;\n  }\n\n  // use single callback if you want to override the previous success callback instead of executing all\n  then(fn, isSingleCallback = false) {\n    if (isSingleCallback) {\n      this.successCallbacks = [fn.bind(this)];\n    } else {\n      this.successCallbacks.push(fn.bind(this));\n    }\n\n    return this;\n  }\n\n  fail(fn, isSingleCallback = false) {\n    if (isSingleCallback) {\n      this.failCallbacks = [fn.bind(this)];\n    } else {\n      this.failCallbacks.push(fn.bind(this));\n    }\n\n    return this;\n  }\n}\n"]}