{"version":3,"sources":["../../src/forms/formBuilder.js"],"names":["formBuilder","isLikeStringOrNum","element","isAnErrorEl","type","displayName","isAFormErrorElClass","props","htmlFor","getErrorMsg","name","errors","getErrorElProps","forInput","msg","getErrorClassElProps","inputName","errorClassName","className","mergeCallbacks","args","e","filter","isFunction","arg","forEach","cb","getHasValueClassName","formElementValue","isEmpty","value","getErrorInputClassName","hasErrors","getValidateEvents","eventType","formGroupProps","onValidate","onInvalidate","invalidateEvent","validateEvent","lastFocusValue","getLastFocusValue","getVal","getFormElProps","onChange","onBlurProp","onBlur","onFocus","values","onValueChange","stringRefs","getKeyVal","Error","onChangeEvents","onFocusEvents","onBlurEvents","key","ref","node","hasTheValueChanged","join","getElProps","getChildren","childrenProp","recurFormBuilder","Children","map","children","elementProps","elementChildren","bind","cloneElement"],"mappings":"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","file":"formBuilder.js","sourcesContent":["import React from 'react';\nimport validate from 'validate.js';\nimport { isAReactEl, isAFormEl, isAFormGroup } from './formUtils';\nimport { ERROR_INPUT_CLASS_NAME, HAS_VALUE_CLASS_NAME } from './formConstants';\nimport { getFormElementRefName } from './formElement/formElementUtils';\nimport formElementFromState from './formElement/formElementFromState';\nimport formElementFromEvt from './formElement/formElementFromEvt';\n\nfunction isLikeStringOrNum(element) {\n  return !isAReactEl(element);\n}\n\nfunction isAnErrorEl({ type }) {\n  return type.displayName === 'FormError';\n}\n\nfunction isAFormErrorElClass({ props }) {\n  return !!props['data-form-error'] || !!props.htmlFor;\n}\n\nfunction getErrorMsg(name, errors) {\n  return (errors[name] || [])[0];\n}\n\nfunction getErrorElProps(element, { errors }) {\n  const { forInput } = element.props;\n  return {\n    ...element.props,\n    msg: getErrorMsg(forInput, errors)\n  };\n}\n\nfunction getErrorClassElProps(element, { errors }) {\n  const inputName = element.props['data-form-error'] || element.props.htmlFor;\n  const errorClassName = getErrorMsg(inputName, errors) ? ERROR_INPUT_CLASS_NAME : '';\n\n  return {\n    ...element.props,\n    className: `${element.props.className} ${errorClassName}`\n  };\n}\n\nfunction mergeCallbacks(...args) {\n  return (e) => {\n    args.filter(arg => validate.isFunction(arg))\n      .forEach(cb => cb(e));\n  };\n}\n\nfunction getHasValueClassName(formElementValue) {\n  const element = formElementValue || {};\n  return validate.isEmpty(element.value) ? '' : HAS_VALUE_CLASS_NAME;\n}\n\nfunction getErrorInputClassName(name, errors) {\n  const hasErrors = !!getErrorMsg(name, errors);\n  return hasErrors ? ERROR_INPUT_CLASS_NAME : '';\n}\n\nfunction getValidateEvents(eventType, formGroupProps) {\n  const {\n    onValidate,\n    onInvalidate,\n    invalidateEvent,\n    validateEvent\n  } = formGroupProps;\n\n  if (\n    invalidateEvent === eventType\n    && validateEvent === eventType\n  ) {\n    return (...args) => {\n      onInvalidate(...args);\n      onValidate(...args);\n    };\n  }\n\n  if (invalidateEvent === eventType) {\n    return onInvalidate;\n  }\n\n  if (validateEvent === eventType) {\n    return onValidate;\n  }\n\n  return null;\n}\n\nlet lastFocusValue = null;\nfunction getLastFocusValue(e) {\n  lastFocusValue = formElementFromEvt(e).getVal();\n}\n\nfunction getFormElProps(element, formGroupProps) {\n  const {\n    name,\n    onChange,\n    onBlur: onBlurProp,\n    onFocus,\n    className\n  } = element.props;\n\n  const {\n    errors,\n    values,\n    onValueChange,\n    stringRefs\n  } = formGroupProps;\n\n  const formElementValue = formElementFromState(element, values).getKeyVal();\n\n  if (validate.isEmpty(name)) {\n    throw new Error(`${element.type} element is missing a name attribute!`, element);\n  }\n\n\n  const onChangeEvents = mergeCallbacks(onValueChange, onChange, getValidateEvents('onChange', formGroupProps));\n  const onFocusEvents = mergeCallbacks(onFocus, getLastFocusValue, getValidateEvents('onFocus', formGroupProps));\n  const onBlurEvents = mergeCallbacks(getValidateEvents('onBlur', formGroupProps));\n\n  return {\n    ...element.props,\n    key: name,\n    ref(node) {\n      stringRefs[getFormElementRefName(element)] = node;\n    },\n    onChange: onChangeEvents,\n    onFocus: onFocusEvents,\n    onBlur: (e) => {\n      if (onBlurProp) {\n        onBlurProp(e);\n      }\n\n      const hasTheValueChanged = formElementFromEvt(e).getVal() !== lastFocusValue;\n      if (hasTheValueChanged) {\n        onBlurEvents(e);\n      }\n    },\n    className: [\n      className,\n      getErrorInputClassName(name, errors),\n      getHasValueClassName(formElementValue)\n    ].join(' '),\n    ...formElementValue\n  };\n}\n\nfunction getElProps(element, args) {\n  if (isAFormEl(element)) {\n    return getFormElProps(element, args);\n  }\n\n  if (isAFormErrorElClass(element)) {\n    return getErrorClassElProps(element, args);\n  }\n\n  if (isAnErrorEl(element)) {\n    return getErrorElProps(element, args);\n  }\n\n  return element.props;\n}\n\nfunction getChildren(childrenProp, recurFormBuilder) {\n  if (isAReactEl(childrenProp)) {\n    return recurFormBuilder();\n  }\n\n  return childrenProp;\n}\n\nexport default function formBuilder(args) {\n  return React.Children.map(args.children, (element) => {\n    if (isLikeStringOrNum(element) || isAFormGroup(element)) {\n      return element;\n    }\n\n    const { children } = element.props;\n    const elementProps = getElProps(element, args);\n    const elementChildren = getChildren(\n      children,\n      formBuilder.bind(null, { ...args, children })\n    );\n\n    return [React.cloneElement(\n      element,\n      elementProps,\n      elementChildren\n    )];\n  });\n}\n"]}